# Internationalization (i18n) for AI Providers

This document explains how AI providers integrate translations to allow users to customize labels and text.

## Overview

The i18n system provides:
- Hierarchical translation key fallbacks (provider-specific â†’ generic defaults)
- Automatic translation extraction from OpenAPI schemas
- Dynamic label translation for custom UI components
- User-overridable labels for all UI text

**Key principle:** All providers register translations during initialization. Users can override any translation key.

## Translation Key Conventions

### Hierarchy

Translation keys follow a hierarchical fallback pattern:

```
1. Provider-specific: ly.img.plugin-ai-{kind}-generation-web.{modelKey}.property.{propertyName}.{value}
2. Generic property:  ly.img.plugin-ai-generation-web.property.{propertyName}.{value}
3. Provider defaults: ly.img.plugin-ai-{kind}-generation-web.{modelKey}.defaults.property.{propertyName}.{value}
4. Generic defaults:  ly.img.plugin-ai-generation-web.defaults.property.{propertyName}.{value}
```

The system tries each key in order until a translation is found.

### Key Patterns

| Pattern | Purpose | Example |
|---------|---------|---------|
| `ly.img.plugin-ai-{kind}-generation-web.{modelKey}.property.{prop}.{value}` | Property enum value | `ly.img.plugin-ai-image-generation-web.fal-ai/recraft-v3.property.style.realistic_image` |
| `ly.img.plugin-ai-{kind}-generation-web.{modelKey}.property.{prop}.placeholder` | Input placeholder | `ly.img.plugin-ai-image-generation-web.partner/model.property.prompt.placeholder` |
| `libraries.{panelId}.history.label` | Generation history label | `libraries.ly_img_ai_fal_ai_recraft_v3.history.label` |
| `panel.{panelId}.{feature}` | Panel UI labels | `panel.ly_img_ai_fal_ai_recraft_v3.styleSelection` |
| `ly.img.ai.quickAction.{actionName}` | Quick action labels | `ly.img.ai.quickAction.styleTransfer` |

### Panel ID Generation

Use the `getPanelId` utility to generate consistent panel IDs:

```typescript
import { getPanelId } from '@imgly/plugin-ai-generation-web';

const modelKey = 'fal-ai/recraft-v3';
const panelId = getPanelId(modelKey);  // 'ly_img_ai_fal_ai_recraft_v3'
```

## Provider Implementation

### Basic Provider (Minimal Translations)

Every provider should register at least the history label:

```typescript
import { getPanelId } from '@imgly/plugin-ai-generation-web';

export function MyTextToImage(config: ProviderConfiguration) {
  return async ({ cesdk }) => {
    const modelKey = 'partner/vendor/model-name';

    // Required: Register history label
    cesdk.i18n.setTranslations({
      en: {
        [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated Images'
      }
    });

    return createImageProvider({ modelKey, ... }, config);
  };
}
```

### Provider with Enum Labels

For providers with style or option enums, register translations for each value:

```typescript
import { getPanelId } from '@imgly/plugin-ai-generation-web';

// Define constants with labels
const STYLES = [
  { id: 'realistic', label: 'Realistic' },
  { id: 'anime', label: 'Anime Style' },
  { id: 'digital_art', label: 'Digital Art' }
];

export function StyledProvider(config: ProviderConfiguration) {
  return async ({ cesdk }) => {
    const modelKey = 'partner/vendor/styled-model';

    // Build style translations dynamically
    const styleTranslations: Record<string, string> = {};
    STYLES.forEach(({ id, label }) => {
      styleTranslations[
        `ly.img.plugin-ai-image-generation-web.${modelKey}.property.style.${id}`
      ] = label;
    });

    cesdk.i18n.setTranslations({
      en: {
        [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated Images',
        ...styleTranslations
      }
    });

    return createImageProvider({ modelKey, ... }, config);
  };
}
```

### Provider with Custom Panels

For providers registering custom panels:

```typescript
cesdk.i18n.setTranslations({
  en: {
    [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated From Text',
    [`panel.${getPanelId(modelKey)}.styleSelection`]: 'Style Selection',
    [`panel.${getPanelId(modelKey)}.imageSelection`]: 'Select Image To Change'
  }
});
```

### Provider with Custom Prompt Placeholder

Override the default prompt placeholder:

```typescript
cesdk.i18n.setTranslations({
  en: {
    [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated Images',
    [`ly.img.plugin-ai-image-generation-web.${modelKey}.property.prompt.placeholder`]:
      'A serene mountain landscape at sunset...'
  }
});
```

## Translation Callbacks for Dynamic Labels

For custom property renderers that display asset sources with dynamic labels, use the translation callback:

```typescript
import { createTranslationCallback } from '@imgly/plugin-ai-generation-web';

// Create a translation callback for style property
const translateLabel = createTranslationCallback(
  cesdk,
  modelKey,      // e.g., 'fal-ai/recraft-v3'
  'style',       // property name
  'image'        // plugin type
);

// Use with CustomAssetSource
const assetSource = new CustomAssetSource(
  sourceId,
  styles.map((style) => ({
    id: style.id,
    label: style.label,
    thumbUri: getStyleThumbnail(style.id)
  })),
  { translateLabel }  // Pass translation callback
);
```

The callback returns the translated label, falling back through the key hierarchy.

## Default Translations

The base plugin provides default translations for common properties. You don't need to register these:

```typescript
// Already provided by plugin-ai-generation-web
'ly.img.plugin-ai-generation-web.defaults.property.prompt': 'Prompt',
'ly.img.plugin-ai-generation-web.defaults.property.style': 'Style',
'ly.img.plugin-ai-generation-web.defaults.property.aspect_ratio': 'Aspect Ratio',
'ly.img.plugin-ai-generation-web.defaults.property.duration': 'Duration',
'ly.img.plugin-ai-generation-web.defaults.property.resolution': 'Resolution',

// Common aspect ratios
'ly.img.plugin-ai-generation-web.defaults.property.aspect_ratio.1:1': '1:1 (Square)',
'ly.img.plugin-ai-generation-web.defaults.property.aspect_ratio.16:9': '16:9 (Widescreen)',
'ly.img.plugin-ai-generation-web.defaults.property.aspect_ratio.9:16': '9:16 (Vertical)',

// Common resolutions
'ly.img.plugin-ai-generation-web.defaults.property.resolution.720p': '720p HD',
'ly.img.plugin-ai-generation-web.defaults.property.resolution.1080p': '1080p Full HD',
```

**Only register translations for:**
- Provider-specific values (e.g., custom styles)
- Values not covered by defaults
- Labels you want to customize

## OpenAPI Schema Labels

Enum labels can also be defined in the JSON schema using `x-imgly-enum-labels`:

```json
{
  "style": {
    "type": "string",
    "title": "Style",
    "enum": ["realistic", "anime", "digital_art"],
    "x-imgly-enum-labels": {
      "realistic": "Realistic",
      "anime": "Anime Style",
      "digital_art": "Digital Art"
    }
  }
}
```

The system extracts these automatically. Use `cesdk.i18n.setTranslations()` when you need:
- Runtime-determined labels
- Labels for custom property renderers
- Override schema-defined labels

## Translation Key Arrays in UI

When building UI with the builder API, provide translation key arrays for fallback:

```typescript
builder.Button(`${property.id}`, {
  inputLabel: [
    // Provider-specific
    `ly.img.plugin-ai-image-generation-web.${modelKey}.property.${property.id}`,
    // Generic property
    `ly.img.plugin-ai-generation-web.property.${property.id}`,
    // Provider defaults
    `ly.img.plugin-ai-image-generation-web.${modelKey}.defaults.property.${property.id}`,
    // Generic defaults
    `ly.img.plugin-ai-generation-web.defaults.property.${property.id}`
  ],
  // ...
});
```

## User Configuration

Users can override any translation:

```typescript
// Override history label
cesdk.i18n.setTranslations({
  en: {
    'libraries.ly_img_ai_partner_model.history.label': 'My Custom Label'
  }
});

// Add German translations
cesdk.i18n.setTranslations({
  de: {
    'libraries.ly_img_ai_partner_model.history.label': 'Generierte Bilder',
    'ly.img.plugin-ai-image-generation-web.partner/model.property.style.realistic': 'Realistisch'
  }
});
```

## Provider Checklist

- [ ] **History label**: Register `libraries.{panelId}.history.label`
- [ ] **Enum values**: Register translations for custom enum values (styles, etc.)
- [ ] **Panel labels**: Register translations for any custom panels
- [ ] **Placeholders**: Optionally register custom prompt placeholders
- [ ] **Default fallbacks**: Only register what differs from defaults
- [ ] **Key format**: Follow naming conventions exactly (dots, modelKey format)

## Common Patterns

### Text-to-Image Provider

```typescript
cesdk.i18n.setTranslations({
  en: {
    [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated From Text'
  }
});
```

### Image-to-Image Provider

```typescript
cesdk.i18n.setTranslations({
  en: {
    [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated From Image'
  }
});
```

### Video Provider

```typescript
cesdk.i18n.setTranslations({
  en: {
    [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated Videos'
  }
});
```

### Provider with Custom Quick Action Labels

```typescript
cesdk.i18n.setTranslations({
  en: {
    'ly.img.ai.quickAction.styleTransfer': 'Change Art Style',
    'ly.img.ai.quickAction.artists': 'Painted By',
    [`libraries.${getPanelId(modelKey)}.history.label`]: 'Generated From Image'
  }
});
```
